<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<title data-react-helmet="true">Forwarding data to the server | Predicting Insect Pest Phenology</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Forwarding data to the server | Predicting Insect Pest Phenology"><meta data-react-helmet="true" name="description" content="We&#x27;ll need a device to transfer data from the sensors (LoRa radio) to the server; this device is called a gateway, and usually made using a Raspberry Pi and various modules."><meta data-react-helmet="true" property="og:description" content="We&#x27;ll need a device to transfer data from the sensors (LoRa radio) to the server; this device is called a gateway, and usually made using a Raspberry Pi and various modules."><meta data-react-helmet="true" property="og:url" content="https://frareb.github.io/pi2p_docu/docs/docClim03"><link data-react-helmet="true" rel="shortcut icon" href="/pi2p_docu/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://frareb.github.io/pi2p_docu/docs/docClim03"><link rel="stylesheet" href="/pi2p_docu/styles.e6e8e8cd.css">
<link rel="preload" href="/pi2p_docu/styles.77ed040e.js" as="script">
<link rel="preload" href="/pi2p_docu/runtime~main.348db3af.js" as="script">
<link rel="preload" href="/pi2p_docu/main.329e6bef.js" as="script">
<link rel="preload" href="/pi2p_docu/1.89a34cc7.js" as="script">
<link rel="preload" href="/pi2p_docu/2.8e5e4543.js" as="script">
<link rel="preload" href="/pi2p_docu/3.f9d5adc5.js" as="script">
<link rel="preload" href="/pi2p_docu/1be78505.03e05814.js" as="script">
<link rel="preload" href="/pi2p_docu/42.ffd0b841.js" as="script">
<link rel="preload" href="/pi2p_docu/83a783d7.aec4cfc3.js" as="script">
<link rel="preload" href="/pi2p_docu/17896441.0613a534.js" as="script">
<link rel="preload" href="/pi2p_docu/94c135c3.5dffc78e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/pi2p_docu/"><img class="navbar__logo" src="/pi2p_docu/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">PI2P</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pi2p_docu/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://pi2p.ird.fr" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">PI2P website</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/pi2p_docu/"><img class="navbar__logo" src="/pi2p_docu/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">PI2P</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/pi2p_docu/docs/">Docs</a></li><li class="menu__list-item"><a href="https://pi2p.ird.fr" target="_blank" rel="noopener noreferrer" class="menu__link">PI2P website</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">PI2P</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pi2p_docu/docs/">Introduction</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Climate</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pi2p_docu/docs/docClim01">Climate monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pi2p_docu/docs/docClim02">Gathering on-site measurements</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/pi2p_docu/docs/docClim03">Forwarding data to the server</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Insects</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pi2p_docu/docs/docPest01">Insect monitoring</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Forwarding data to the server</h1></header><div class="markdown"><p>We&#x27;ll need a device to transfer data from the sensors (LoRa radio) to the server; this device is called a gateway, and usually made using a Raspberry Pi and various modules.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="1-the-raspberry-pi-gateway"></a>1. The Raspberry Pi gateway<a aria-hidden="true" tabindex="-1" class="hash-link" href="#1-the-raspberry-pi-gateway" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="11-how-to-make-the-gateway"></a>1.1. How to make the gateway?<a aria-hidden="true" tabindex="-1" class="hash-link" href="#11-how-to-make-the-gateway" title="Direct link to heading">#</a></h3><p>The gateway is composed of at least a Raspberry Pi board, a RFM95 radio module for receiving sensors data and a PCF8523 real-time clock, that will keep track of the date even when the network or the Raspberry are disconnected.</p><p>As a main gateway board, you can use either of these Raspberry Pi :</p><ul><li>Raspberry Pi 3A+</li><li>Raspberry Pi 3B+</li><li>Raspberry Pi Zero W</li></ul><p>Connect the to modules to the board according to the following diagram:</p><p><img src="/pi2p_docu/img/Raspberry_Pi_RFM95_RTC.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="12-how-to-make-it-work"></a>1.2. How to make it work?<a aria-hidden="true" tabindex="-1" class="hash-link" href="#12-how-to-make-it-work" title="Direct link to heading">#</a></h3><p>Once your gateway is assembled, you&#x27;ll need to run a program that will send data to the server; this procedure follows three simple steps:</p><ul><li>asking for a gateway key (or rolling your own server);</li><li>copying the example code;</li><li>adding your encryption key to the gateway and running the code!</li></ul><p>If you went to this section, you should already have visited the previous page about the sensors; if not, please read at least section 3 of the previous page; therefore, you&#x27;re supposed to have downloaded the entire <a href="https://github.com/frareb/pi2p/tree/master/Task03" target="_blank" rel="noopener noreferrer"><code>Task03</code> directory</a> of the main Github repository.</p><p>First, please contact <a href="mailto:contact" target="_blank" rel="noopener noreferrer">François Rebaudo</a> to get a gateway key that will allow you to post data to the PI2P project server.</p><p>Once you have the key, you can simply go to the <code>sit_final</code> repository; the file there are required for encryption between the sensor and the gateway; you&#x27;ll need to compile and install them with the following commands:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> python3 setup.py build</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> python3 setup.py </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pip3 </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> adafruit-circuitpython-rfm9x</span></div></div></div></div></div><p>Nothing should go wrong, and you can now go to the <code>gateway</code> directory, and edit the file <code>forward.py</code>, to match the following:</p><ul><li>edit the <code>BASE_URL</code> to match the server you&#x27;re using (<a href="https://pi2p.ird.fr/sensors)" target="_blank" rel="noopener noreferrer">https://pi2p.ird.fr/sensors)</a>;</li><li>the <code>GW_KEY</code> is the gateway key that was given to you by the server owner;</li><li>the server owner should also give you the ids of the sensors he configured for you, and you should match these ids in the <code>SENSOR_MAP</code> object; by default, <code>&quot;T&quot;</code> is temperature from the DS18B20, <code>&quot;H&quot;</code> is humidity from DHT11/22 and <code>&quot;U&quot;</code> is temperature from the DHT11/22.</li></ul><p>Everything should be fine, so you can now execute <code>python3 forward.py</code>, and power a remote sensor to test your gateway.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="12-additional-sensors"></a>1.2. Additional sensors<a aria-hidden="true" tabindex="-1" class="hash-link" href="#12-additional-sensors" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="121-bme280bme680"></a>1.2.1. BME280/BME680<a aria-hidden="true" tabindex="-1" class="hash-link" href="#121-bme280bme680" title="Direct link to heading">#</a></h4><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="122-si1145"></a>1.2.2. SI1145<a aria-hidden="true" tabindex="-1" class="hash-link" href="#122-si1145" title="Direct link to heading">#</a></h4><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="123-picam-noir"></a>1.2.3. PiCam NoIR<a aria-hidden="true" tabindex="-1" class="hash-link" href="#123-picam-noir" title="Direct link to heading">#</a></h4><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="2-alternatives"></a>2. Alternatives<a aria-hidden="true" tabindex="-1" class="hash-link" href="#2-alternatives" title="Direct link to heading">#</a></h2></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/pi2p_docu/docs/docClim02"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Gathering on-site measurements</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/pi2p_docu/docs/docPest01"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Insect monitoring »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-the-raspberry-pi-gateway" class="table-of-contents__link">1. The Raspberry Pi gateway</a><ul><li><a href="#11-how-to-make-the-gateway" class="table-of-contents__link">1.1. How to make the gateway?</a></li><li><a href="#12-how-to-make-it-work" class="table-of-contents__link">1.2. How to make it work?</a></li><li><a href="#12-additional-sensors" class="table-of-contents__link">1.2. Additional sensors</a></li></ul></li><li><a href="#2-alternatives" class="table-of-contents__link">2. Alternatives</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/pi2p_docu/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/pi2p_docu/docs/docClim01/">Climate</a></li><li class="footer__item"><a class="footer__link-item" href="/pi2p_docu/docs/docPest01/">Insects</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://pi2p.ird.fr" target="_blank" rel="noopener noreferrer" class="footer__link-item">PI2P Website</a></li><li class="footer__item"><a href="http://www.egce.cnrs-gif.fr/?p=1196" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/pi2p_docu/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/frareb/pi2p" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2021 PI2P, This projet is funded by ANR grant number <a href="https://anr.fr/Project-ANR-19-CE32-0001">ANR-19-CE32-0001.</a></div></div></div></footer></div>
<script src="/pi2p_docu/styles.77ed040e.js"></script>
<script src="/pi2p_docu/runtime~main.348db3af.js"></script>
<script src="/pi2p_docu/main.329e6bef.js"></script>
<script src="/pi2p_docu/1.89a34cc7.js"></script>
<script src="/pi2p_docu/2.8e5e4543.js"></script>
<script src="/pi2p_docu/3.f9d5adc5.js"></script>
<script src="/pi2p_docu/1be78505.03e05814.js"></script>
<script src="/pi2p_docu/42.ffd0b841.js"></script>
<script src="/pi2p_docu/83a783d7.aec4cfc3.js"></script>
<script src="/pi2p_docu/17896441.0613a534.js"></script>
<script src="/pi2p_docu/94c135c3.5dffc78e.js"></script>
</body>
</html>